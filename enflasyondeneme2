import streamlit as st
import pandas as pd
import numpy as np
import requests
from bs4 import BeautifulSoup
import re
from datetime import datetime
import json
import time

# --- SAYFA AYARLARI ---
st.set_page_config(page_title="EnflasyonAI", layout="wide", page_icon="ðŸ¤–")

# --- ðŸŽ¨ PREMIUM TASARIM (CSS) ---
st.markdown("""
<style>
Â  Â  /* Google Font: Poppins */
Â  Â  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

Â  Â  html, body, [class*="css"]Â  {
Â  Â  Â  Â  font-family: 'Poppins', sans-serif;
Â  Â  Â  Â  background-color: #f3f4f6; /* Ã‡ok aÃ§Ä±k gri arka plan */
Â  Â  Â  Â  color: #1f2937;
Â  Â  }

Â  Â  /* HERO SECTION (Ãœst BaÅŸlÄ±k) */
Â  Â  .hero {
Â  Â  Â  Â  background: linear-gradient(120deg, #2563eb, #1e40af);
Â  Â  Â  Â  padding: 40px 20px;
Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  color: white;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  box-shadow: 0 10px 25px -10px rgba(37, 99, 235, 0.5);
Â  Â  }
Â  Â  .hero h1 {
Â  Â  Â  Â  font-size: 3.5rem;
Â  Â  Â  Â  font-weight: 800;
Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  color: white;
Â  Â  Â  Â  letter-spacing: -1px;
Â  Â  }
Â  Â  .hero p {
Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  Â  font-weight: 300;
Â  Â  Â  Â  opacity: 0.9;
Â  Â  Â  Â  margin-top: 10px;
Â  Â  }

Â  Â  /* METRÄ°K KARTLARI */
Â  Â  div[data-testid="metric-container"] {
Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  padding: 25px;
Â  Â  Â  Â  border-radius: 16px;
Â  Â  Â  Â  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
Â  Â  Â  Â  border: 1px solid #e5e7eb;
Â  Â  Â  Â  transition: transform 0.2s ease, box-shadow 0.2s ease;
Â  Â  Â  Â  text-align: center;
Â  Â  }
Â  Â  div[data-testid="metric-container"]:hover {
Â  Â  Â  Â  transform: translateY(-5px);
Â  Â  Â  Â  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  border-color: #3b82f6;
Â  Â  }
Â  Â  div[data-testid="metric-container"] label {
Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  color: #6b7280;
Â  Â  }
Â  Â  div[data-testid="metric-container"] div[data-testid="stMetricValue"] {
Â  Â  Â  Â  font-size: 2.2rem;
Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  color: #111827;
Â  Â  }

Â  Â  /* BUTON STÄ°LÄ° (PULSE ANÄ°MASYONLU) */
Â  Â  @keyframes pulse {
Â  Â  Â  Â  0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
Â  Â  Â  Â  70% { box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); }
Â  Â  Â  Â  100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
Â  Â  }

Â  Â  .stButton > button {
Â  Â  Â  Â  background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
Â  Â  Â  Â  color: white;
Â  Â  Â  Â  border: none;
Â  Â  Â  Â  padding: 20px 40px;
Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  border-radius: 50px;
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  letter-spacing: 1px;
Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3);
Â  Â  Â  Â  animation: pulse 2s infinite;
Â  Â  }
Â  Â  .stButton > button:hover {
Â  Â  Â  Â  transform: scale(1.02);
Â  Â  Â  Â  background: linear-gradient(90deg, #2563eb 0%, #1d4ed8 100%);
Â  Â  Â  Â  box-shadow: 0 20px 25px -5px rgba(37, 99, 235, 0.4);
Â  Â  Â  Â  animation: none; /* Ãœzerine gelince animasyon dursun */
Â  Â  }
Â  Â Â 
Â  Â  /* BÄ°LGÄ° KUTULARI (INFO) */
Â  Â  .stAlert {
Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  border: none;
Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
Â  Â  }
Â  Â Â 
Â  Â  /* TABLO TASARIMI */
Â  Â  .stDataFrame {
Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
Â  Â  }
</style>
""", unsafe_allow_html=True)

# --- MODERN HEADER (HTML) ---
st.markdown("""
<div class="hero">
Â  Â  <h1>ðŸ¤– EnflasyonAI</h1>
Â  Â  <p>Yapay Zeka Destekli GerÃ§ek ZamanlÄ± Piyasa Analisti</p>
</div>
""", unsafe_allow_html=True)

# --- REFERANS (GEÃ‡EN AY) FÄ°YATLARI (+%10 ARTIRILDI) ---
# Bu fiyatlar, web Ã§ekme baÅŸarÄ±sÄ±z olduÄŸunda baz alÄ±nacaktÄ±r.
REF_PRICES = {
Â  Â  "Sebze": 38.50, "Meyve": 49.50, "Et/SÃ¼t": 495.00, "Temel": 242.00,
Â  Â  "KÄ±yafet": 770.00, "AyakkabÄ±": 1980.00,
Â  Â  "Mobilya": 24200.00, "Beyaz EÅŸya": 15400.00,
Â  Â  "YakÄ±t": 46.20, "Toplu TaÅŸÄ±ma": 16.50, "AraÃ§": 1265000.00,
Â  Â  "Ä°laÃ§": 44.00, "Okul": 352000.00, "Sigara": 99.00, "Fatura": 30.80
}

# --- YARDIMCI FONKSÄ°YONLAR ---
def get_soup(url):
Â  Â  # Daha agresif bir User-Agent kullanmak, bazÄ± sitelerde yardÄ±mcÄ± olabilir.
Â  Â  headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"}
Â  Â  try:
Â  Â  Â  Â  response = requests.get(url, headers=headers, timeout=10)
Â  Â  Â  Â  if response.status_code == 200:
Â  Â  Â  Â  Â  Â  return BeautifulSoup(response.content, "html.parser")
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  # YanÄ±t kodu 200 deÄŸilse (Ã¶rneÄŸin 403 Forbidden)
Â  Â  Â  Â  Â  Â  print(f"Hata: URL'den yanÄ±t alÄ±namadÄ± ({response.status_code}): {url}")
Â  Â  except requests.exceptions.RequestException as e:
Â  Â  Â  Â  # BaÄŸlantÄ± zaman aÅŸÄ±mÄ± veya baÅŸka bir istek hatasÄ±
Â  Â  Â  Â  print(f"Hata: Ä°stek baÅŸarÄ±sÄ±z oldu ({url}): {e}")
Â  Â  return None

def clean_price(price_str):
Â  Â  if not price_str: return 0.0
Â  Â  try:
Â  Â  Â  Â  clean = str(price_str).replace('â‚º', '').replace('TL', '').strip()
Â  Â  Â  Â  # Binlik ayÄ±rÄ±cÄ±yÄ± kaldÄ±r, ondalÄ±k ayÄ±rÄ±cÄ±yÄ± nokta yap
Â  Â  Â  Â  if "," in clean and "." in clean: # 1.234,56 formatÄ±
Â  Â  Â  Â  Â  Â  clean = clean.replace('.', '').replace(',', '.')
Â  Â  Â  Â  elif "," in clean: # 1,234 formatÄ± (binlik) veya 1,23 formatÄ± (ondalÄ±k)
Â  Â  Â  Â  Â  Â  # En basit yol: TÃ¼m noktalari sil, kalan virgÃ¼lu nokta yap (TR formatÄ±)
Â  Â  Â  Â  Â  Â  clean = clean.replace('.', '').replace(',', '.')
Â  Â  Â  Â  return float(clean)
Â  Â  except:
Â  Â  Â  Â  return 0.0

# --- VERÄ° Ã‡EKME MODÃœLLERÄ° ---
# NOT: Web Ã§ekme kÄ±sÄ±tlamalarÄ± nedeniyle, bu fonksiyonlar baÅŸarÄ±sÄ±z olduÄŸunda 
# uygulamanÄ±n kÄ±rÄ±lmamasÄ± iÃ§in simÃ¼lasyon/referans fiyatlarÄ± kullanÄ±lmÄ±ÅŸtÄ±r.

def fetch_gida():
Â  Â  data = []
Â  Â  # GÄ±da iÃ§in Onur Market'teki URL'ler, scraping engeline takÄ±ldÄ±ÄŸÄ± iÃ§in
    # bu fonksiyonun baÅŸarÄ±sÄ±z olma olasÄ±lÄ±ÄŸÄ± yÃ¼ksektir.
Â  Â  gida_dict = {
Â  Â  Â  Â  "Sebze": [("Domates", "https://www.onurmarket.com/domates-kg--8126"), ("Biber", "https://www.onurmarket.com/biber-carliston-kg--8101")],
Â  Â  Â  Â  "Et/SÃ¼t": [("Antrikot", "https://www.onurmarket.com/-ksp.et-dana-antrikot-kg--121"), ("PiliÃ§", "https://www.onurmarket.com/butun-pilic-kg")],
Â  Â  Â  Â  "Temel": [("AyÃ§iÃ§ek YaÄŸÄ±", "https://www.onurmarket.com/-komili-aycicek-pet-4-lt--69469"), ("Ã‡ay", "https://www.onurmarket.com/-caykur-tiryaki-1000-gr--3947")]
Â  Â  }
    
Â  Â  for kat, items in gida_dict.items():
Â  Â  Â  Â  for isim_ref, url in items:
Â  Â  Â  Â  Â  Â  fiyat = 0; isim = isim_ref
Â  Â  Â  Â  Â  Â  soup = get_soup(url)
            
Â  Â  Â  Â  Â  Â  if soup:
Â  Â  Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  # ÃœrÃ¼n AdÄ± Ã‡ekme
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tag = soup.find("div", class_="ProductName")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if tag: 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isim = tag.find("h1").get_text(strip=True)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  # Fiyat Ã‡ekme
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  p_tag = soup.find("span", class_="spanFiyat")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if p_tag: 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fiyat = clean_price(p_tag.get_text())
                    
Â  Â  Â  Â  Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print(f"GÄ±da scraping hatasÄ±: {e}")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fiyat = 0 # Hata durumunda fiyatÄ± sÄ±fÄ±rla

            # Web Ã§ekme baÅŸarÄ±sÄ±z olursa (fiyat 0 kalÄ±rsa), Referans fiyatÄ± kullan ve bunu belirt.
Â  Â  Â  Â  Â  Â  if fiyat == 0:
                # Referans fiyatÄ±n %5 fazlasÄ±nÄ± "gÃ¼ncel fiyat" olarak simÃ¼le edelim
Â  Â  Â  Â  Â  Â  Â  Â  fiyat = REF_PRICES.get(kat, 1) * 1.05
                isim = f"{isim_ref} (SimÃ¼lasyon/Web Ã‡ekme BaÅŸarÄ±sÄ±z)"
            
Â  Â  Â  Â  Â  Â  data.append({"Grup": "GÄ±da", "Kategori": kat, "ÃœrÃ¼n": isim, "Fiyat": fiyat, "Baz Fiyat": REF_PRICES.get(kat, 1)})
Â  Â  return pd.DataFrame(data)

def fetch_giyim():
Â  Â  data = []
Â  Â  # Koton & Flo Ã–rnekleri
Â  Â  urls = [
Â  Â  Â  Â  ("KÄ±yafet", "https://www.koton.com/pamuklu-slim-fit-uzun-kollu-italyan-yaka-gomlek-lacivert-4022961-2/"),
Â  Â  Â  Â  ("AyakkabÄ±", "https://www.flo.com.tr/urun/inci-acel-4fx-kahverengi-erkek-klasik-ayakkabi-101544485")
Â  Â  ]
Â  Â  for kat, url in urls:
Â  Â  Â  Â  soup = get_soup(url)
Â  Â  Â  Â  fiyat = 0; isim = "Moda ÃœrÃ¼nÃ¼"
Â  Â  Â  Â  if soup:
Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  # Basit genel tarama
Â  Â  Â  Â  Â  Â  Â  Â  title = soup.find("h1")
Â  Â  Â  Â  Â  Â  Â  Â  if title: isim = title.get_text(strip=True)
Â  Â  Â  Â  Â  Â  Â  Â  # Flo ve Koton fiyat classlarÄ± deÄŸiÅŸebiliyor, genel arama
Â  Â  Â  Â  Â  Â  Â  Â  price_divs = soup.find_all("div", class_=re.compile("price"))
Â  Â  Â  Â  Â  Â  Â  Â  for p in price_divs:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  txt = p.get_text()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if "TL" in txt or "â‚º" in txt:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  extracted = clean_price(txt)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if extracted > 10: # MantÄ±klÄ± bir fiyatsa al
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fiyat = extracted
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break
Â  Â  Â  Â  Â  Â  except Exception as e:
                print(f"Giyim scraping hatasÄ±: {e}")
                fiyat = 0

Â  Â  Â  Â  # Web Ã§ekme baÅŸarÄ±sÄ±z olursa (fiyat 0 kalÄ±rsa), Referans fiyatÄ± kullan ve bunu belirt.
Â  Â  Â  Â  if fiyat == 0:
Â  Â  Â  Â  Â  Â  fiyat = REF_PRICES.get(kat, 1) * 1.05
Â  Â  Â  Â  Â  Â  isim = f"{isim} (SimÃ¼lasyon/Web Ã‡ekme BaÅŸarÄ±sÄ±z)"

Â  Â  Â  Â  data.append({"Grup": "Giyim", "Kategori": kat, "ÃœrÃ¼n": isim, "Fiyat": fiyat, "Baz Fiyat": REF_PRICES.get(kat, 1)})
Â  Â  return pd.DataFrame(data)

def fetch_genel_piyasa():
Â  Â  data = []
Â  Â  # UlaÅŸÄ±m & YakÄ±t
Â  Â  po_url = "https://www.petrolofisi.com.tr/akaryakit-fiyatlari"
Â  Â  soup = get_soup(po_url)
Â  Â  f_benzin = 0; f_motorin = 0
    isim_benzin = "Benzin (L)"; isim_motorin = "Motorin (L)"

Â  Â  if soup:
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  # Petrol Ofisi verisi, sayfanÄ±n yapÄ±sÄ± deÄŸiÅŸirse burasÄ± Ã§alÄ±ÅŸmayabilir.
Â  Â  Â  Â  Â  Â  rows = soup.find_all("tr", class_="price-row")
Â  Â  Â  Â  Â  Â  if rows:
Â  Â  Â  Â  Â  Â  Â  Â  cols = rows[0].find_all("td")
Â  Â  Â  Â  Â  Â  Â  Â  # 1. sÃ¼tun Benzin, 2. sÃ¼tun Motorin (site yapÄ±sÄ±na gÃ¶re)
Â  Â  Â  Â  Â  Â  Â  Â  f_benzin = clean_price(cols[1].find("span").get_text())
Â  Â  Â  Â  Â  Â  Â  Â  f_motorin = clean_price(cols[2].find("span").get_text())
Â  Â  Â  Â  except Exception as e:
            print(f"YakÄ±t scraping hatasÄ±: {e}")
            f_benzin = 0; f_motorin = 0

    # Benzinde Ã§ekme baÅŸarÄ±sÄ±z olursa
Â  Â  if f_benzin == 0:
Â  Â  Â  Â  f_benzin = REF_PRICES["YakÄ±t"] * 1.05
        isim_benzin = f"{isim_benzin} (SimÃ¼lasyon/Web Ã‡ekme BaÅŸarÄ±sÄ±z)"
    # Motorinde Ã§ekme baÅŸarÄ±sÄ±z olursa
Â  Â  if f_motorin == 0:
Â  Â  Â  Â  f_motorin = REF_PRICES["YakÄ±t"] * 1.06 # Motorin biraz daha farklÄ± artmÄ±ÅŸ gibi simÃ¼le edelim
        isim_motorin = f"{isim_motorin} (SimÃ¼lasyon/Web Ã‡ekme BaÅŸarÄ±sÄ±z)"
Â  Â Â 
Â  Â  data.append({"Grup": "UlaÅŸÄ±m", "Kategori": "YakÄ±t", "ÃœrÃ¼n": isim_benzin, "Fiyat": f_benzin, "Baz Fiyat": REF_PRICES["YakÄ±t"]})
Â  Â  data.append({"Grup": "UlaÅŸÄ±m", "Kategori": "YakÄ±t", "ÃœrÃ¼n": isim_motorin, "Fiyat": f_motorin, "Baz Fiyat": REF_PRICES["YakÄ±t"]})
Â  Â Â 
Â  Â  # DiÄŸer Sabitler (Bu fiyatlar zaten sabittir, web Ã§ekme yoktur)
Â  Â  data.append({"Grup": "UlaÅŸÄ±m", "Kategori": "AraÃ§", "ÃœrÃ¼n": "Hyundai i20", "Fiyat": 1256000.00, "Baz Fiyat": REF_PRICES["AraÃ§"]})
Â  Â  data.append({"Grup": "SaÄŸlÄ±k", "Kategori": "Ä°laÃ§", "ÃœrÃ¼n": "Aspirin", "Fiyat": 50.00, "Baz Fiyat": REF_PRICES["Ä°laÃ§"]})
Â  Â Â 
Â  Â  return pd.DataFrame(data)

# --- ANA GÃ–VDE ---

# KullanÄ±cÄ±yÄ± karÅŸÄ±layan info kutusu (Daha ÅŸÄ±k)
st.info("â„¹ï¸ Analizi baÅŸlatmak iÃ§in aÅŸaÄŸÄ±daki butona tÄ±klayÄ±n. Sistem anlÄ±k olarak market ve borsa verilerini tarayacaktÄ±r.")

col_btn1, col_btn2, col_btn3 = st.columns([1, 2, 1])
with col_btn2:
Â  Â  start_btn = st.button("ðŸš€ ANALÄ°ZÄ° BAÅžLAT")

if start_btn:
Â  Â Â 
Â  Â  # Ä°lerleme Ã‡ubuÄŸu ve Spinner
Â  Â  progress_text = "Yapay zeka piyasayÄ± tarÄ±yor..."
Â  Â  my_bar = st.progress(0, text=progress_text)
Â  Â Â 
Â  Â  # AdÄ±m 1: GÄ±da
Â  Â  df1 = fetch_gida()
Â  Â  my_bar.progress(40, text="GÄ±da fiyatlarÄ± gÃ¼ncellendi...")
Â  Â Â 
Â  Â  # AdÄ±m 2: Giyim
Â  Â  df2 = fetch_giyim()
Â  Â  my_bar.progress(70, text="Tekstil verileri iÅŸleniyor...")
Â  Â Â 
Â  Â  # AdÄ±m 3: Genel
Â  Â  df3 = fetch_genel_piyasa()
Â  Â  my_bar.progress(100, text="Analiz tamamlandÄ±!")
Â  Â Â 
Â  Â  # BirleÅŸtir
Â  Â  df_final = pd.concat([df1, df2, df3], ignore_index=True)
Â  Â  # Web Ã§ekme baÅŸarÄ±sÄ±z olsa bile, artÄ±k referans fiyatlar kullanÄ±ldÄ±ÄŸÄ± iÃ§in 0'dan bÃ¼yÃ¼k olma garantisi var.
Â  Â  df_final = df_final[df_final["Fiyat"] > 0] 
Â  Â Â 
Â  Â  # Hesaplama
Â  Â  df_final["DeÄŸiÅŸim (%)"] = ((df_final["Fiyat"] - df_final["Baz Fiyat"]) / df_final["Baz Fiyat"]) * 100
Â  Â Â 
Â  Â  total_now = df_final["Fiyat"].sum()
Â  Â  total_base = df_final["Baz Fiyat"].sum()
Â  Â  inflation = ((total_now - total_base) / total_base) * 100
Â  Â Â 
Â  Â  time.sleep(0.5)
Â  Â  my_bar.empty()
Â  Â Â 
Â  Â  # --- SONUÃ‡ EKRANI ---
Â  Â Â 
Â  Â  # Metrikler
Â  Â  c1, c2, c3 = st.columns(3)
Â  Â  c1.metric("ðŸ›’ CanlÄ± Sepet TutarÄ±", f"{total_now:,.2f} â‚º")
Â  Â  c2.metric("ðŸ“… Baz DÃ¶nem (GeÃ§en Ay)", f"{total_base:,.2f} â‚º")
Â  Â Â 
Â  Â  # Enflasyon rengi (YÃ¼ksekse kÄ±rmÄ±zÄ±)
Â  Â  delta_color = "inverse" if inflation > 0 else "normal"
Â  Â  c3.metric("ðŸ”¥ KiÅŸisel Enflasyon", f"%{inflation:.2f}", delta=f"{inflation:.2f}% DeÄŸiÅŸim", delta_color=delta_color)
Â  Â Â 
Â  Â  st.markdown("---")
Â  Â Â 
Â  Â  # Tablo
Â  Â  st.subheader("ðŸ“‹ DetaylÄ± ÃœrÃ¼n Analizi")
Â  Â Â 
Â  Â  def color_change(val):
Â  Â  Â  Â  color = '#ef4444' if val > 0 else '#10b981'
Â  Â  Â  Â  return f'color: {color}; font-weight: bold;'

Â  Â  st.dataframe(
Â  Â  Â  Â  df_final.style.format({
Â  Â  Â  Â  Â  Â  "Fiyat": "{:.2f} â‚º",Â 
Â  Â  Â  Â  Â  Â  "Baz Fiyat": "{:.2f} â‚º",Â 
Â  Â  Â  Â  Â  Â  "DeÄŸiÅŸim (%)": "%{:.2f}"
Â  Â  Â  Â  }).applymap(color_change, subset=['DeÄŸiÅŸim (%)']),
Â  Â  Â  Â  use_container_width=True,
Â  Â  Â  Â  height=500
Â  Â  )
Â  Â Â 
Â  Â  # Ä°ndirme Butonu (OrtalanmÄ±ÅŸ)
Â  Â  csv = df_final.to_csv(index=False).encode('utf-8-sig')
Â  Â  col_d1, col_d2, col_d3 = st.columns([1,2,1])
Â  Â  with col_d2:
Â  Â  Â  Â  st.download_button(
Â  Â  Â  Â  Â  Â  label="ðŸ“¥ Raporu Ä°ndir (Excel/CSV)",
Â  Â  Â  Â  Â  Â  data=csv,
Â  Â  Â  Â  Â  Â  file_name="EnflasyonAI_Raporu.csv",
Â  Â  Â  Â  Â  Â  mime="text/csv",
Â  Â  Â  Â  Â  Â  key='download-btn'
Â  Â  Â  Â  )
